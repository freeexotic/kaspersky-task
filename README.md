# Kaspersky File Scanner (Задача отборочного этапа)

Высокопроизводительный многопоточный файловый сканер для обнаружения потенциально опасных файлов на Linux системах. Утилита использует MD5-хеширование файлов и сравнивает их с базой известных сигнатур.

## Возможности

- **Многопоточное сканирование** - автоматически определяет количество CPU ядер и использует их для параллельной обработки
- **Рекурсивный обход директорий** - сканирует все поддиректории в указанном пути
- **MD5 хеширование** - быстрое вычисление контрольных сумм файлов с использованием OpenSSL
- **Гибкая база сигнатур** - поддержка CSV файлов с пользовательскими определениями угроз
- **Детальное логирование** - запись всех найденных угроз в лог-файл
- **Прогресс-индикатор** - отображение процента выполнения в реальном времени
- **Статистика производительности** - подробный отчет по завершении сканирования

## Системные требования

- Linux (тестировалось на Ubuntu/Debian)
- C++17 совместимый компилятор (GCC 7+, Clang 5+)
- CMake 3.5 или выше
- OpenSSL development libraries

## Установка

### Установка зависимостей

#### Ubuntu/Debian:
```bash
sudo apt update
sudo apt install build-essential cmake libssl-dev
```

#### CentOS/RHEL/Fedora:
```bash
# CentOS/RHEL
sudo yum install gcc-c++ cmake openssl-devel

# Fedora
sudo dnf install gcc-c++ cmake openssl-devel
```

### Сборка проекта

```bash
# Клонирование проекта (если используется git)
git clone <repository-url>
cd kaspersky

# Создание build директории
mkdir build
cd build

# Конфигурация и сборка
cmake ..
make

# Исполняемый файл создается как build/kaspersky
```

## Использование

### Базовый синтаксис

```bash
./kaspersky --base <path_to_signatures> --log <log_file> --path <scan_directory>
```

### Параметры командной строки

- `--base` или `--b` - путь к файлу базы сигнатур (CSV формат)
- `--log` или `--l` - путь к файлу логов для записи найденных угроз
- `--path` или `--p` - директория для сканирования (рекурсивно)

### Примеры использования

#### Сканирование домашней директории:
```bash
./kaspersky --base ../data/base.csv --log scan_results.log --path /home/username
```

#### Сканирование системной папки с сохранением в определенный лог:
```bash
./kaspersky --base ./signatures.csv --log /var/log/security_scan.log --path /usr/local
```

#### Использование коротких параметров:
```bash
./kaspersky --b threats.csv --l report.log --p /opt
```

## Формат базы сигнатур

База сигнатур представляет собой CSV файл с разделителем `;`. Каждая строка содержит:
- MD5 хеш файла (32 символа в hex формате)
- Название/тип угрозы

### Пример файла signatures.csv:
```csv
5d41402abc4b2a76b9719d911017c592;TestThreat
098f6bcd4621d373cade4e832627b4f6;Malware.Generic
86fb269d190d2c85f6e0468ceca42a20;Trojan.Linux
```

### Создание собственной базы:

```bash
# Получение MD5 хеша файла
md5sum suspicious_file.bin
# Вывод: a1b2c3d4e5f6... suspicious_file.bin

# Добавление в базу
echo "a1b2c3d4e5f6789012345678901234ab;CustomThreat" >> my_signatures.csv
```

## Интерпретация результатов

### Прогресс сканирования
Во время работы программа выводит:
```
[25.5%] Обработано: 1250/4900
[67.8%] Обработано: 3321/4900 | УГРОЗА: /path/to/file.bin (Malware.Generic)
```

### Финальный отчет
По завершении отображается сводка:
```
=== Отчет о сканировании ===
Общее количество файлов: 4900
Обработано файлов: 4900
Количество вредоносных файлов: 3
Количество ошибок: 0
Время выполнения: 2847 мс
Количество потоков: 8
=============================
```

### Лог-файл
Все найденные угрозы записываются в указанный лог-файл:
```
Файл: /home/user/suspicious.exe
Хеш: 5d41402abc4b2a76b9719d911017c592
Вердикт: TestThreat
-------------------------
Файл: /opt/app/malware.bin
Хеш: 098f6bcd4621d373cade4e832627b4f6
Вердикт: Malware.Generic
-------------------------
```

## Производительность и оптимизация

### Многопоточность
- Программа автоматически определяет количество CPU ядер
- Использует все доступные ядра для параллельной обработки
- На 8-ядерной системе ожидается ~6-8x ускорение по сравнению с однопоточным сканированием

### Рекомендации по производительности

1. **SSD диски** - значительно ускоряют чтение файлов
2. **Достаточный объем RAM** - для кэширования файловой системы
3. **Исключение сетевых дисков** - избегайте сканирования NFS/CIFS mount points
4. **Размер базы сигнатур** - большие базы (>100K записей) могут замедлить работу

### Производительность по типам файлов

| Тип файлов | Скорость обработки |
|------------|-------------------|
| Текстовые файлы (< 1MB) | ~1000-5000 файлов/сек |
| Бинарные файлы (1-10MB) | ~100-500 файлов/сек |
| Большие файлы (>100MB) | ~1-10 файлов/сек |

## Устранение проблем

### Ошибки сборки

**Ошибка: OpenSSL не найден**
```bash
# Убедитесь что установлены dev пакеты
sudo apt install libssl-dev  # Ubuntu/Debian
sudo yum install openssl-devel  # CentOS/RHEL
```

**Ошибка: C++17 не поддерживается**
```bash
# Обновите компилятор
sudo apt install gcc-8 g++-8  # Ubuntu 18.04
# или используйте более новую версию системы
```

### Ошибки выполнения

**"Ошибка: указанный путь не является директорией"**
- Проверьте правильность пути к сканируемой директории
- Убедитесь что директория существует и доступна для чтения

**"Не удалось открыть файл лога"**  
- Проверьте права доступа к директории для лог-файла
- Убедитесь что путь к лог-файлу корректен

**"File not found" для базы сигнатур**
- Проверьте путь к CSV файлу с базой
- Убедитесь что файл существует и доступен для чтения

### Проблемы производительности

**Медленное сканирование:**
- Проверьте использование CPU (должно быть близко к 100% на всех ядрах)
- Избегайте сканирования сетевых дисков
- Исключите из сканирования временные и кэш-директории

**Высокое потребление памяти:**
- Нормальное потребление: ~10-50MB  
- При сканировании директорий с миллионами файлов возможно увеличение до 100-200MB

## Безопасность

### Права доступа
- Программе требуются права на чтение сканируемых файлов
- Для сканирования системных директорий может потребоваться sudo:
```bash
sudo ./kaspersky --base signatures.csv --log /var/log/scan.log --path /
```

### Конфиденциальность
- Программа читает только первые блоки файлов для хеширования
- Содержимое файлов не передается по сети
- Все данные обрабатываются локально

### Производственное использование
- Рекомендуется тестирование на небольших наборах данных перед массовым сканированием
- Используйте проверенные базы сигнатур из надежных источников
- Регулярно обновляйте базы сигнатур для обнаружения новых угроз

## Лицензия

Проект разработан для образовательных и исследовательских целей. Используйте на свой страх и риск.

## Поддержка

При возникновении проблем:
1. Проверьте системные требования
2. Убедитесь в корректности параметров запуска  
3. Проверьте лог-файлы на наличие сообщений об ошибках
4. Протестируйте на небольшой тестовой директории

---

**Примечание:** Данная утилита предназначена для обнаружения файлов по их MD5 хешам и не является полноценным антивирусным решением. Для защиты production систем используйте профессиональные решения безопасности.
